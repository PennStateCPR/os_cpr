var commit=commit||{};(function($){"use strict";commit.contactinfo={selectors:{form:"#contactinfo",dobControl:"#dobControl",dob:"#dob",dobMonth:"#dobMonth",dobDay:"#dobDay",dobYear:"#dobYear",dobPopover:"#dobPopover",dobPopoverContent:"#dobPopoverContent",email:"#email",primaryEmail:"#primaryEmail",emailPopover:"#emailPopover",emailPopoverContent:"#emailPopoverContent",phonePopover:"#phonePopover",phonePopoverContent:"#phonePopoverContent",international:"#internationalNumber"},utils:{},validator:{},date:{month:void 0,day:void 0,year:void 0},phone:{us:{required:!0,phoneCommit:!0},international:{required:!0,phoneIntCommit:!0}},getPhoneType:function(){var international=$(this.selectors.international);return international.is(":checked")?this.phone.international:this.phone.us},validate:function(){var selectors=this.selectors;this.validator=new commit.validator({selectors:selectors,rules:{dob:{required:!0,date:!0},email:{required:!0,email:!0},phoneNumber:{required:!0,phoneCommit:!0}},messages:{dob:{required:"Please enter your date of birth.",date:"Please enter a valid date of birth"},email:{required:"Please enter your email."},phoneNumber:{required:"Please enter your phone number."}},formModal:!0,formPopover:!0,focus:!0,verify:!0})},onInternationalSelect:function(){var selectors,form,validator,phoneType;selectors=this.selectors,form=$(selectors.form),validator=form.data.validator,phoneType=this.getPhoneType(),form.data().hasOwnProperty("validator")&&(form.data().validator.settings.rules.phoneNumber=phoneType)},addLeadingZero:function(value){return value=parseInt(value,10),10>value&&(value="0"+(""+value)),value},removeLeadingZero:function(value){return value=parseInt(value,10)},getYearFromSelect:function(){var dobYear=$(this.selectors.dobYear),value=dobYear.val();return value},getDayFromSelect:function(){var dobDay=$(this.selectors.dobDay),value=dobDay.val();return value},getMonthFromSelect:function(){var dobMonth=$(this.selectors.dobMonth),value=dobMonth.val();return value},getDateOfBirth:function(){var dobMonth,dobDay,dobYear,formatted;return dobMonth=this.getMonthFromSelect(),dobDay=this.getDayFromSelect(),dobYear=this.getYearFromSelect(),formatted=dobMonth+"/"+dobDay+"/"+dobYear},buildMonths:function(){var months,dobMonth,template,value;months=["Jan.","Feb.","Mar.","Apr.","May","Jun.","Jul.","Aug.","Sept.","Oct.","Nov.","Dec."],dobMonth=$(this.selectors.dobMonth),template="",value=0,_.each(months,_.bind(function(month,idx){value=this.addLeadingZero(idx+1),template=template+'<option value="'+value+'">'+month+"</option>"},this)),dobMonth.html(template),dobMonth.val(this.date.month)},buildDays:function(){var dobDay,month,year,days,day,template,value;dobDay=$(this.selectors.dobDay),month=this.removeLeadingZero(this.getMonthFromSelect()),year=this.getYearFromSelect(),days=new Date(year,month,0).getDate(),day=this.getDayFromSelect()||this.date.day,day=this.removeLeadingZero(day),template="",value=0;for(var i=1;days>=i;i++)value=this.addLeadingZero(i),template=template+'<option value="'+value+'">'+value+"</option>";dobDay.html(template),day>=days&&(day=days),day=this.addLeadingZero(day),dobDay.val(day)},buildYears:function(){for(var dobYear=$(this.selectors.dobYear),date=new Date,yearEnd=date.getFullYear()-1,yearStart=yearEnd-100,template="",i=yearStart;yearEnd>=i;i++)template=template+'<option value="'+i+'">'+i+"</option>";dobYear.html(template),dobYear.val(this.date.year)},buildDate:function(){var dob,date,month,year,day;dob=$(this.selectors.dob),_.isEmpty(dob.val())?(date=new Date,month=date.getMonth()+1,year=date.getFullYear()-1,day=date.getDate()):(date=dob.val().split("/"),month=date[0],day=date[1],year=date[2]),this.date.month=this.addLeadingZero(month),this.date.day=this.addLeadingZero(day),this.date.year=year},buildSelects:function(){var dob=$(this.selectors.dob);this.buildDate(),this.buildMonths(),this.buildYears(),this.buildDays(),dob.val(this.getDateOfBirth())},initializeDatepicker:function(){this.buildSelects()},initializeDatepickerListeners:function(){var dob=$(this.selectors.dob),control=$(this.selectors.dobControl),select=control.find("select");select.on("change",_.bind(function(evt){var targetId="#"+$(evt.target).attr("id");targetId!==this.selectors.dobDay&&this.buildDays(),dob.val(this.getDateOfBirth())},this))},initializeViewPopovers:function(){var emailPopover,emailPopoverContent,phonePopover,phonePopoverContent,dobPopover,dobPopoverContent;emailPopover=$(this.selectors.emailPopover),emailPopoverContent=$(this.selectors.emailPopoverContent).html(),phonePopover=$(this.selectors.phonePopover),phonePopoverContent=$(this.selectors.phonePopoverContent).html(),dobPopover=$(this.selectors.dobPopover),dobPopoverContent=$(this.selectors.dobPopoverContent).html(),this.utils.popover(emailPopover,emailPopoverContent),this.utils.popover(dobPopover,dobPopoverContent),this.utils.popover(phonePopover,phonePopoverContent)},attachModalListeners:function(){var email,primaryEmail,dialog;email=$(this.selectors.email),primaryEmail=$(this.selectors.primaryEmail),dialog=this.validator.dialog,dialog.on("show",_.bind(function(){primaryEmail.html($.trim(email.val()))},this)),dialog.on("hidden",_.bind(function(){primaryEmail.html("")},this))},initialize:function(){_.bindAll(this),this.utils=commit.utils,this.initializeDatepicker(),this.initializeDatepickerListeners(),this.initializeViewPopovers(),this.validate(),this.attachModalListeners()}},commit.contactinfo.initialize()})(jQuery,_);